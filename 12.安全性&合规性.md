## 责任模型：

| AWS的责任                                      | 客户的责任                                   | 共享的责任          |
|---------------------------------------------|--------------------------------------------|-------------------|
| - **硬件**和软件基础设施的管理和维护。          | - **管理宾客操作系统**，包括安全补丁和更新。      | - **补丁管理**          |
| - 计算、存储、数据库和网络基础设施的运营。 | - **防火墙和网络配置**，**应用数据安全**，**云中对公司资产进行分类**                 | - **配置管理，身份和访问管理**          |
| - 全球基础设施、区域、可用区和边缘位置。    | - IAM（身份和访问管理）以及加密应用程序数据。 | - **意识和培训**         |

**customers are always responsible for managing their own customer data**

## RDS和S3责任对比

| **AWS服务**                 | **AWS的责任**                                      | **客户的责任**                                                                                     |
|-----------------------------|---------------------------------------------------|--------------------------------------------------------------------------------------------------|
| **RDS（关系数据库服务）**   | - 管理底层的EC2实例                               | - 检查数据库安全组中的端口/IP/入站规则                                                           |
|                             | - 禁用SSH访问                                       | - 管理数据库中的用户创建和权限                                                                     |
|                             | - 数据库补丁                                    | - 创建数据库时设置访问权限                                                                        |
|                             | - **操作系统补丁**                                 | - 确保参数组或数据库配置为仅允许SSL连接                                                         |
|                             | - 审计底层实例和磁盘                             | - 配置数据库加密设置                                                                              |
| **S3（简单存储服务）**     | - 确保无限存储和加密                              | - 配置S3桶的安全性和公共访问设置                                                                  |
|                             | - 数据分隔，防止AWS员工访问数据                   | - 管理IAM用户和角色，确保适当的访问控制和权限                                                     |
|                             |                                                   | - 启用S3桶中的数据加密，以确保数据在存储时得到加密保护                                             |


## Shield：DDoS防护解决方案

AWS Shield是AWS提供的专业DDoS（分布式拒绝服务）防护解决方案，旨在确保您的应用程序和资源免受恶意攻击的威胁。

CloudFront和Route 53：提供全球边缘网络的可用性保护，并与AWS Shield集成，以在边缘处进行攻击缓解。

**Shield仅用于保护运行中的应用程序免受DDoS攻击。**

AWS Shield包括以下两个层次的服务：

### Shield Standard

- 是一项免费的DDoS保护服务，适用于所有AWS客户。它提供了基本的DDoS防护功能，帮助您抵御常见的DDoS攻击。

### Shield Advanced

- 对于需要更高级、全天候DDoS保护的客户，AWS提供了付费的Shield Advanced服务。它提供了更强大的DDoS防护能力，包括实时攻击监控和专业支持

## Web Application Firewall (WAF)：

**是一个网络应用防火墙，它帮助保护您的网络应用程序或API免受可能影响可用性、危害安全或消耗过多资源的常见网络攻击。**

WAF可保护免受常见攻击，**如SQL注入和跨站脚本（XSS）。**

它可以部署在应用负载均衡器、API网关和CloudFront上。

Web访问控制列表（ACLs）可以定义规则，这些规则可以包括IP地址、HTTP头、HTTP主体内容或URI字符串。

可以使用大小约束和地理匹配规则来阻止特定国家/地区。

速率限制规则用于分布式拒绝服务（DDoS）保护。

## Network Firewall：

它在从第3层到第7层保护整个VPC

检查可以在任何方向执行，包括VPC到VPC、从互联网出站、从互联网入站以及与Direct Connect和Site-to-Site VPN之间的来往。

## 对比表格

| 服务名称             | 部署位置             | 主要功能                                                                                   |
|----------------------|----------------------|--------------------------------------------------------------------------------------------|
| Shield Standard      | N/A                  | - 免费的DDoS保护服务，适用于所有AWS客户。                                                    |
| Shield Advanced      | N/A                  | - 付费服务，提供全天候高级DDoS保护。                                                       |
|                                                                                           |
| Web Application Firewall (WAF) | 可以部署在应用负载均衡器、API网关和CloudFront上。 | - 定义规则过滤特定请求，包括IP地址、HTTP头、HTTP主体内容或URI字符串。                     |
|                      |                      | - 保护免受常见攻击，**如SQL注入和跨站脚本（XSS）**。                                          |
|                      |                      | - 使用大小约束和地理匹配规则来阻止特定国家/地区。                                      |
|                      |                      | - 使用速率限制规则进行分布式拒绝服务（DDoS）保护。                                       |
|                                                                                           |
| Network Firewall      |                      | - 在从第3层到第7层保护整个VPC。                                                          |
|                      |                      | - 可以检查来自不同方向的流量，包括VPC到VPC、从互联网出站、从互联网入站，以及与Direct Connect和Site-to-Site VPN之间的来往。 |

## Firewall Manager：

**允许公司集中管理和配置AWS资源的防火墙规则，包括Amazon VPC安全组。通过AWS Firewall Manager，公司可以跨多个AWS账户轻松管理VPC安全组规则**

## 云上进行渗透测试：

AWS客户可以对其AWS基础架构执行安全评估或渗透测试，无需事先获得批准，涵盖8项服务

### 云上进行渗透测试期间禁止的活动：

包括通过Route 53 Hosted Zones进行**DNS区域遍历、拒绝服务（DoS）攻击、分布式拒绝服务（DDoS）攻击、模拟DoS、端口洪泛、协议洪泛和请求洪泛**。

## 数据静态 vs. 数据传输中

- **静态：Data at rest"意味着数据被存储或归档在某个设备上。**
  
  - 在硬盘，RDS实例，S3 Glacier深度归档等上。
    
- 传输中（移动中）：数据从一个位置移动到另一个位置
  
  - 从本地传输到AWS，EC2到DynamoDB等。
    
我们希望在这两种状态下加密数据以保护它！

为此我们利用加密密钥

## KMS（密钥管理服务）

- 每当您听到AWS服务的“加密”，它很可能是KMS
  
- **KMS为我们管理加密密钥**

### KMS密钥类型

- 客户管理的密钥：
  
  - 由客户创建、管理和使用，可以启用或禁用
    
  - 有轮换策略的可能性（每年生成新密钥，旧密钥被保留）
    
  - 可能性带来您自己的密钥

- AWS管理的密钥：
  
  - 由AWS代表客户创建、管理和使用
    
  - 由AWS服务使用（aws/s3, aws/ebs, aws/redshift）

- AWS拥有的密钥：
  
  - AWS服务拥有和管理的CMKs集合，用于在多个账户中使用
    
  - AWS可以使用这些来保护您账户中的资源（但您不能查看密钥）

- CloudHSM密钥（自定义密钥库）：
  
  - 从您自己的CloudHSM硬件设备生成的密钥
    
  - 密码操作在CloudHSM集群内执行

## 不同加密形式：

- KMS => 加密软件
  
- CloudHSM => 加密硬件
  
- 专用硬件（HSM = 硬件安全模块）
  
- 您完全管理自己的加密密钥（不是AWS）
  
- HSM设备是抗篡改的，符合FIPS 140-2三级合规性

### 在S3中，可以使用以下两种加密类型来保护对象的静态存储：

Server-side encryption with Amazon S3 managed encryption keys (SSE-S3)

Server-side encryption with AWS KMS managed keys (SSE-KMS)

## ACM（证书管理器）

**是一项服务，让您可以轻松配置、管理和部署用于AWS服务和您内部连接资源的公共和私有安全套接层/传输层安全（SSL/TLS）证书。**
 
## Secrets Manager

**是专门用于管理敏感数据，如数据库凭据、API密钥和其他敏感信息的AWS服务。**

**它具有内置的凭据轮换功能，可以根据预定的计划自动轮换数据库用户凭据，而无需额外的操作或脚本。**

- 较新的服务，用于存储密钥
  
- 能力强制每X天旋转密钥
  
- 自动化旋转密钥生成（使用Lambda）
  
- 与Amazon RDS（MySQL、PostgreSQL、Aurora）集成
  
- 密钥使用KMS加密
  
- 主要用于RDS集成

## Systems Manager Parameter Store：

和Secrets Manager都可以用于存储配置数据和敏感信息。

在两者之间的选择通常取决于具体的需求和功能。

如果您的主要关注点是**成本效益**，那么AWS Systems Manager Parameter Store可能更受青睐，因为它有免费层，对于简单用例可能更具成本效益。

**Secrets Manager**具有专门设计用于管理机密信息的附加功能，如**自动轮换**，可能更适用于复杂的机密管理场景。

总之，这两个选项都可以满足需求，但对于某些用例，Systems Manager Parameter Store可能**更具成本效益**

## Health Dashboard：

**是AWS提供的一个服务状态和事件通知中心，它可以向用户提供有关AWS服务的可用性、性能和事件的信息**

### Personal Health Dashboard（个人健康仪表板）：用于查看与公司AWS资源相关的个人健康事件和警报。

### Service Health Dashboard（服务健康仪表板）：用于查看AWS全球基础设施的当前状态和健康信息。

## Artifact

**提供了与 AWS 服务的安全性和合规性相关的合规性报告和其他文档的访问**

**提供答案给AWS用户最常问的与安全相关问题**

- 为客户提供即时访问AWS合规性文档和AWS协议的门户
  
- Artifact报告 - 允许您下载AWS安全和合规性文件，如AWS ISO认证、支付卡行业（PCI）和系统与组织控制（SOC）报告
  
- Artifact协议 - 允许您审查、接受并追踪商业合作附加协议（BAA）或健康保险携带与责任法案（HIPAA）的状态
  
- 可用于支持内部审计或合规性

## GuardDuty：

**是一种威胁检测服务，它持续监控恶意活动和未授权行为，以保护您的AWS账户和工作负载。**

## Inspector

是一个自动化的安全评估服务，

帮助提高部署在AWS上的应用程序的安全性和合规性。

它可以帮助您测试EC2实例的网络可访问性以及运行在这些实例上的应用程序的安全状态。

### Inspector评估什么？

**记住：只适用于EC2实例、容器镜像和Lambda函数**

只在需要时对基础设施进行连续扫描

包漏洞（EC2、ECR和Lambda）——CVE数据库

网络可达性（EC2）

所有漏洞都有一个风险评分，用于优先级排序

## Macie

是一个完全托管的数据安全和数据隐私服务，使用机器学习和模式匹配来**发现和保护您在AWS中的敏感数据**。

Macie帮助识别并向您报告敏感数据，如个人身份信息（PII）

流程：**从S3存储桶分析数据**，Macie发现敏感数据（PII），通知，最后整合到Amazon EventBridge。

## 三者用途对比：

| 功能               | GuardDuty                                   | Inspector                                 | Macie                                  |
|--------------------|--------------------------------------------|-------------------------------------------|----------------------------------------|
| 主要用途           | 持续监控恶意活动和未授权行为，保护AWS账户和工作负载 | 自动化的安全评估服务，提高应用程序安全性和合规性 | 数据安全和隐私服务，发现和保护敏感数据    |
| 适用于哪些资源类型 | AWS账户和工作负载                           | EC2实例、容器镜像、Lambda函数                | S3存储桶中的数据                         |
| 安全评估           | 检测威胁和未授权行为，提供警报和详细信息     | 进行**漏洞扫描**、网络可达性测试，提供报告         | 发现敏感数据、报告并整合到Amazon EventBridge |

## Config

帮助审计和记录您的AWS资源的合规性

**帮助记录配置和随时间变化的变更**

可以将配置数据存储到S3中（由Athena分析）

### Config可以解决的问题：

我的安全组是否有不受限制的SSH访问？

我的存储桶是否有任何公共访问权限？

我的ALB配置随时间如何变化？

对任何变化可以接收警报（SNS通知）

AWS Config是按区域服务

可以跨区域和账户聚合

## Security Hub

**在多个AWS账户中集中自动执行安全检查。**

**是云安全姿态管理（CSPM）服务，可以将来自各种AWS服务和合作伙伴产品的警报以标准化格式聚合起来**

## Detective

**分析、调查，并快速识别安全问题或可疑活动的根本原因（使用机器学习和图表）。**

自动收集并处理来自VPC流量日志、CloudTrail、GuardDuty的事件，并创建统一视图。

产生带有详细信息和上下文的可视化，以找到根本原因。

## Abuse

应该联系AWS滥用团队的情况包括：

垃圾邮件、端口扫描、DoS或DDoS攻击、入侵尝试、托管有异议或受版权保护的内容、分发恶意软件。

## Root user privileges

根用户 = 账户所有者（创建账户时创建）。

对所有AWS服务和资源有完全访问权限。

锁好你的AWS账户根用户访问密钥！

不要使用根账户进行日常任务，甚至是管理任务。

### 只能由根用户执行的操作：

更改账户设置（账户名称、邮箱地址、根用户密码、根用户访问密钥）。

查看特定税务发票。

关闭您的AWS账户。

恢复IAM用户权限。

更改或取消您的AWS支持计划。

在保留实例市场注册为卖家。

配置Amazon S3桶以启用MFA。

编辑或删除包含无效VPC ID或VPC端点ID的Amazon S3桶策略。

注册GovCloud。

**非根用户可以访问计费仪表板：默认情况下，只有根用户可以访问计费仪表板，但您可以为IAM用户附加一个策略，使其可以访问计费仪表板。**

## IAM Access Analyzer

**了解哪些资源被外部共享**

S3 Bucket

IAM Roles

KMS Keys

Lambda Functions and Layers

SQS queues

Secrets Manager Secrets

定义信任区域 = AWS账户或AWS组织

区域外的访问 => 发现

## 总结：

Macie：使用机器学习技术自动发现、分类和保护敏感数据的服务。

GuardDuty：持续监测恶意或未经授权的行为以保护AWS账户和工作负载。

Inspector：自动安全评估服务，帮助改善应用程序的安全性和合规性。

Config：提供AWS资源的配置历史记录，以及变更跟踪和评估对安全性的影响。

Firewall Manager：简化了AWS WAF规则的管理过程，让用户可以在多个AWS账户中集中配置和管理防火墙规则。

IAM Access Analyzer：分析AWS Identity and Access Management (IAM)策略，帮助用户确保所授权的权限不会导致意外的资源访问。

Systems Manager：提供对AWS资源的可见性和控制，帮助自动化管理任务。

Health：提供AWS服务的健康状况和维护信息。

Shield：自动DDoS防护 + 24/7高级支持。

WAF：根据规则过滤进来的请求的防火墙。

KMS：由AWS管理的加密密钥。

CloudHSM：硬件加密，AWS管理加密密钥。

AWS证书管理器：配置、管理和部署SSL/TLS证书。

Artifact：获取合规报告访问权，如PCI、ISO等。

CloudTrail：跟踪账户内用户所做的API调用。

Security Hub：从多个AWS账户收集安全发现。

Detective：找出安全问题或可疑活动的根本原因。

Abuse：报告用于滥用或非法目的的AWS资源。

根用户权限：更改账户设置，关闭AWS账户，更改或取消AWS支持计划，在保留实例市场注册为卖家。














