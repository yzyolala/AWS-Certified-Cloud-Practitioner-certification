## AWS中的IP地址：

IPv4，拥有约43亿个地址的限制。

**公共IPv4**，可用于互联网。

EC2实例每次停止和启动时都会获得一个新的公共IPv4地址。

**私有IPv4**，用于像局域网（LAN）这样的私有网络。

对于EC2实例，私有IPv4是固定的，即使它们被启动或停止也是如此。

弹性IP是一个固定的公共IPv4地址，可以附加到EC2实例，注意如果没有附加到EC2实例或者EC2实例停止了，它会产生持续的费用。

IPv6是最新版本的互联网协议，具有显着更大的地址空间。

## VPC：

**是专属于您的AWS帐户的虚拟网络。它在AWS云中在逻辑上与其他虚拟网络隔离开来。您可以将AWS资源（例如Amazon EC2实例）启动到您的VPC中。**

VPC是部署资源的私有网络，是一个区域性资源。

子网允许您在VPC内分区您的网络，并与可用性区域绑定。

**公共子网可以从互联网访问，而私有子网不能从互联网访问**

路由表用于定义对互联网和子网之间的访问。

## Internet Gateway和NAT Gateway

**互联网网关：是一个水平扩展、冗余且高可用的VPC组件，它允许您的VPC与互联网之间进行通信。** 就像一个外部进入vpc的大门

NAT网关（**AWS管理**）和NAT实例（**自我管理**）：**允许你的实例在你的私有子网中访问互联网，同时保持私有**。

## 网络ACL和安全组

**网络ACL（Network ACL）**:

就像一个外部进入子网的检查大门

一个控制进出子网流量的防火墙。

可以有允许（ALLOW）和拒绝（DENY）规则。

附加在子网级别。

规则只包括IP地址。

**安全组:**

就像一个外部进入子网中实例的门卫

一个控制进出ENI/EC2实例流量的防火墙。

只能有允许（ALLOW）规则。

规则包括IP地址和其他安全组。

## 安全组vs网络访问控制列表（NACL）

| 安全组 (Security Group) | 网络ACL (Network ACL) |
|------------------------|----------------------|
| 在**实例**级别运行。               | 在**子网**级别运行。          |
| 只支持允许规则。               | 支持允许和拒绝规则。        |
| 是有状态的：无论任何规则，返回流量都会自动被允许。 | 是无状态的：返回流量必须明确地通过规则被允许。 |

## VPC流日志：

**允许您存储有关您的VPC中网络接口发送和接收的IP流量的信息。**

它们有助于监控和排除连接性问题，比如从子网到互联网、子网到子网、互联网到子网的连接。

它们还能捕获来自AWS管理接口的网络信息，例如弹性负载均衡器、ElastiCache、RDS、Aurora等。

VPC流日志数据可以被发送到S3、CloudWatch日志和Kinesis Data Firehose。

## VPC对等连接：

可以将**两个VPC私密地连接在AWS网络中**

这样可以让它们行为表现得像在同一个网络中一样。

两个VPC不能有重叠的CIDR（IP地址范围）。

VPC对等连接不是传递性的，每个需要互相通信的VPC都必须建立一个对等连接。

## VPC端点

可以将**私有网络连接AWS服务**，提供更安全和低延迟的访问。有两种类型的VPC端点：

VPC端点网关：支持连接到S3和DynamoDB。

VPC端点接口：支持连接到其他AWS服务。

## PrivateLink

用于与第三方 VPC 进行通信的时候使用的

是一种安全且可扩展的方式，用于向多个VPC公开服务，无需VPC对等连接、互联网网关、NAT或路由表。

它需要以下组件：网络负载均衡器（服务VPC）和弹性网络接口（客户VPC）。

## 站点到站点VPN和Direct Connect

这两种选项用于连接**本地网络与AWS**，实现安全连接。它们的主要区别如下：

站点到站点VPN：使用本地的客户网关（CGW）和AWS的虚拟私有网关（VGW），通过**公共**互联网建立加密连接。

Direct Connect：建立**私有**、安全、高速的物理连接，连接本地网络和AWS，需要至少一个月来建立。

## 客户端VPN

允许从**个人电脑连接到AWS**和本地的私有网络，通过公共互联网进行连接。这使您可以使用私有IP连接到您的EC2实例，就像它们在私有VPC网络中一样。

## Transit Gateway(中转网关)：

用于在**数千个**VPC和本地之间实现有传递性的对等连接，使用集线式拓扑（hub-and-spoke）。

只需要一个网关就可以提供这个功能。

**它可以和Direct Connect网关、VPN连接一起工作。**

## 对比

| 连接类型           | 描述                                                         | 组件要求                                 | 使用场景                                       |
|--------------------|--------------------------------------------------------------|------------------------------------------|------------------------------------------------|
| VPC端点网关        | 用于连接到S3和DynamoDB的VPC端点                               | VPC                                      | 访问S3和DynamoDB的私有网络                        |
| VPC端点接口        | 用于连接到其他AWS服务的VPC端点                               | VPC                                      | 访问其他AWS服务的私有网络                        |
| PrivateLink        | 用于连接到第三方VPC的安全和可扩展方式                         | 服务VPC中的网络负载均衡器，客户VPC中的ENI | 将服务公开给多个VPC，无需对等连接或互联网连接      |
| 站点到站点VPN      | 使用本地客户网关和AWS虚拟私有网关，在公共互联网上建立加密连接 | 本地客户网关（CGW），AWS虚拟私有网关（VGW） | 安全连接本地网络与AWS                           |
| Direct Connect     | 建立私有、安全、高速的物理连接，连接本地网络和AWS          | 专线接入设备                             | 安全、高速的物理连接本地网络与AWS              |
| 客户端VPN          | 允许个人电脑通过公共互联网连接到AWS和本地的私有网络         | 客户端VPN终端设备                        | 从个人电脑连接到AWS和本地私有网络                |
| Transit Gateway    | 实现有传递性的对等连接，连接数千个VPC和本地                | Transit Gateway                           | 集线式拓扑，多个VPC和本地连接到中转网关           |

## 总结：

VPC：虚拟私有云。

子网：绑定到一个可用区（AZ），是VPC的网络分区。

互联网网关：在VPC层面提供互联网访问。

NAT网关/实例：为私有子网提供互联网访问。

NACL：无状态的，子网级别的入站和出站规则。

安全组：有状态的，在EC2实例层面或ENI运作。

VPC对等连接：连接两个VPC，使用非重叠的IP范围。

弹性IP：固定的公共IPv4地址，如果不使用会持续产生费用。

VPC端点：在VPC内提供对AWS服务的私有访问。

PrivateLink：在第三方VPC中私密地连接到服务。

VPC流日志：网络流量日志。

站点到站点VPN：在本地数据中心和AWS之间通过公共互联网的VPN。

客户端VPN：从你的电脑到你的VPC的OpenVPN连接。

Direct Connect：直接私有连接到AWS。

中转网关：连接数千个VPC和本地网络。

