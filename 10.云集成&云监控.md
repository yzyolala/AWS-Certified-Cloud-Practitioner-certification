## 应用程序通信的两种模式：

同步通信（应用程序到应用程序），通过"购买服务"和"运输服务"的方块显示双向通信。

异步/事件驱动（应用程序到队列到应用程序），其中"购买服务"向"队列"发送消息，然后"运输服务"接收消息，说明了带有队列机制的单向通信。

## 同步通信的问题：

特别是在突然流量激增时。它提出了一个假设情况，即应用程序突然需要编码1000个视频，而平时只有10个。为了解决这种规模问题使用以下方式来解耦应用程序：

SQS（简单队列服务）：用于队列模型

SNS（简单通知服务）：用于发布/订阅模型

Kinesis ：用于实时数据流模型

## SQS：

服务历史悠久：SQS是AWS最早提供的服务之一，已有10多年历史。

完全托管：SQS提供无服务器架构服务，用户无需管理基础设施即可使用。

高可扩展性：支持从每秒1条消息扩展到每秒10000条消息的处理能力。

消息保留期：**消息在队列中的默认保留时间为4天，最长可以设置为14天。**

无消息数量限制：队列中可以存储无限数量的消息。

消费后删除：消息被消费者读取后会自动从队列中删除。

低延迟：消息的发布和接收延迟非常低，通常小于10毫秒。

水平扩展：消费者可以共享读取消息的负载，并支持水平扩展。

拉取机制：SQS使用基于拉取的系统，消费者需要主动从队列中拉取消息。

### 使用SQS进行应用程序层之间解耦的方法：

Web服务器：通过PUT操作将请求发送到SQS队列。

视频处理服务：通过轮询SQS队列来接收和处理请求。

自动扩展：通过配置Auto Scaling Group实现服务的自动扩展，以应对负载变化。

### SQS的FIFO队列的特性：

消息顺序：保证消息的发送和接收顺序一致，先进先出。

顺序保证：对于需要严格消息顺序的应用程序非常关键。

## SNS 

**当使用SQS或SNS时，你会应用到“解耦你的应用程序”原则。这意味着IT系统应该以减少相互依赖的方式设计——一个组件中的变更或故障不应该波及到其他组件**

是一项 AWS 提供的消息通知服务

高可用性、持久性和安全性：SNS 提供持续可靠的消息传递服务。

完全托管的发布/订阅服务：用户无需管理底层的服务器即可使用此服务。

**解耦**服务：允许微服务、分布式系统和无服务器应用程序之间的松散耦合。

推送机制：SNS 使用推送机制将消息直接发送给订阅者。

多接收者：可以将消息发送给多个接收者，不管是直接集成还是通过主题订阅。

发布/订阅模型：发布者发送消息到SNS主题，多个订阅者可以订阅这个主题。

订阅者多样性：订阅者可以是SQS队列、电子邮件地址、Lambda函数、Kinesis Data Firehose服务或是SMS和移动通知。

订阅限制：一个主题可以有高达12,500,000个订阅，总共可以有100,000个主题。

## Kinesis：

Kinesis是**实时大数据流**处理服务。

它是一个托管服务，用于收集、处理和分析实时流数据。

## MQ：

**是一个托管的消息代理服务，支持ActiveMQ和RabbitMQ。**

SQS和SNS是AWS的“云原生”服务，使用AWS专有协议。

传统应用程序运行在本地时可能使用开放协议，如MQTT, AMQP, STOMP, Openwire, WSS。

当迁移到云端时，为了避免重构应用程序以使用SQS和SNS，可以使用Amazon MQ。

与SQS和SNS相比，Amazon MQ的可扩展性有限，它运行在服务器上，并可以在多个可用区（Multi-AZ）中进行故障转移。

MQ同时具备队列功能（类似于SQS）和主题功能（类似于SNS）

## CloudWatch Alarm：

**CloudWatch 警报功能允许您监控 CloudWatch 指标，并在指标超出您配置的阈值（高或低）时接收通知。**

**CloudWatch 是用于监视 AWS 云资源和在 AWS 上运行的应用程序的监控服务。您可以使用亚马逊 CloudWatch 收集和跟踪指标，收集和监视日志文件，并设置警报**

**可以创建CloudWatch警报，以便在达到或超过特定成本阈值时触发警报，并通过多种通知方式（如电子邮件或短信）接收通知。**

警报动作包括：

自动缩放：增加或减少EC2实例的“期望”数量。

EC2操作：停止、终止、重启或恢复EC2实例。

SNS通知：发送通知到SNS主题。

提供多种选项（抽样、百分比、最大、最小等）。

可以选择评估警报的时间段。

例如：在CloudWatch计费指标上创建计费警报。

警报状态：OK、INSUFFICIENT_DATA、ALARM。

### CloudWatch Logs

**CloudWatch Logs来监控、存储并访问来自Amazon Elastic Compute Cloud (Amazon EC2)实例、AWS CloudTrail、Route 53和其他来源的日志文件。**

可以收集日志的来源

Elastic Beanstalk：从应用程序收集日志。

ECS：从容器收集日志。

AWS Lambda：从函数日志收集。

CloudTrail：基于过滤器收集。

CloudWatch log agents：可以在EC2实例或本地服务器上收集日志。

Route53：记录DNS查询。

提供实时日志监控功能。

可以调整CloudWatch日志的保留期限。

### CloudWatch Logs在EC2中的应用：

默认情况下，EC2实例的日志不会自动发送到CloudWatch。

必须在EC2上运行CloudWatch日志代理来推送你想要的日志文件。

需要确保IAM权限设置正确。

CloudWatch日志代理也可以在本地服务器上设置。

## EventBridge：

定时任务：可以安排Cron作业（定时脚本），例如每小时执行一次任务，并触发Lambda函数。

事件模式：可以设置事件规则来响应服务的某些操作，如根据IAM Root用户登录事件来触发。

Lambda函数触发：可以触发Lambda函数，发送SQS/SNS消息。

AWS服务：可以从各种AWS服务接收事件。

默认事件总线：接收来自AWS服务的事件。

AWS SaaS合作伙伴和自定义应用程序：可以从SaaS合作伙伴如Zendesk、Datadog，以及自定义应用程序接收事件。

模式注册表：允许您建模事件架构。

事件存档：您可以存档（全部或根据过滤器）发送到事件总线的事件，无限期或设置特定时间段。

事件回放：提供回放存档事件的能力。

## CloudTrail：

**EC2实例的终止：通过审查CloudTrail日志，您可以确定何时终止了EC2实例，由谁发起了终止操作，以及有关事件的其他相关详细信息。**

资源删除的调查：CloudTrail 对 AWS 资源的删除提供了记录，因此它是调查资源变更的有用工具。**建议如果AWS中的资源被删除，首先应该调查CloudTrail。**

记录各种接口：CloudTrail 记录通过各种接口进行的 **API 调用**，包括控制台、SDK、CLI 和 AWS 服务。

日志传送到 S3 存储桶：CloudTrail 将记录的日志文件传送到您指定的亚马逊 S3 存储桶，以供后续检查和分析使用。

治理、合规和审计：CloudTrail 提供了治理、合规性和审计的功能，帮助您监视账户的安全性和合规性。

默认启用：CloudTrail 在 AWS 上默认启用，以确保账户活动的记录。

跟踪多区域或单一区域：您可以选择将 CloudTrail 的跟踪应用于所有 AWS 区域，或限制在单一区域中进行。

IAM 用户和角色的操作：CloudTrail 记录由 IAM 用户和 IAM 角色执行的操作，以跟踪身份和访问管理。

集中的控制台：CloudTrail 控制台位于中心位置，用于接收并管理所有记录的日志。

## X-Ray：

分析和调试**分布式应用程序**，尤其是**微服务架构**的应用程序。

## CodeGuru：

**提供智能建议，用于提高代码质量并识别应用程序中最昂贵的代码行。**

由机器学习驱动的服务，用于自动化代码审查和应用性能建议

CodeGuru Reviewer：用于静态代码分析（开发阶段）的自动化代码审查。

CodeGuru Profiler：在运行时（生产环境）对应用性能提供可视化和建议。

### CodeGuru Reviewer：

识别关键问题、安全漏洞和难以发现的错误。

例如：常见的编码最佳实践、资源泄露、安全检测、输入验证。

使用机器学习和自动推理。

在成千上万个开源代码库和Amazon仓库上学到的经验教训。

支持Java和Python语言。

与GitHub、Bitbucket和AWS CodeCommit集成。

### CodeGuru Profiler：

帮助理解应用程序的运行时行为。

例如：识别应用程序是否在日志记录例程上消耗过多CPU能力。

特点包括：

识别和移除代码低效率。

提高应用性能（例如减少CPU使用）。

降低计算成本。

提供堆栈摘要（识别使用内存的对象）。

异常检测。

支持在AWS或本地运行的应用程序。

对应用程序的开销最小化。

## Health Dashboard：

**用于显示AWS全球范围内各个区域和服务的运行状况。**

提供每天的历史信息，帮助用户跟踪健康状况的变化。

### Health Dashboard - Your Account：

**提供警报和修复指导，当AWS服务出现可能影响用户的事件时。**

为AWS账户提供个性化的健康仪表板。

与Service Health Dashboard不同，它提供AWS服务背后的性能和可用性的特定视图，而不仅仅是一般状态。

显示相关且及时的信息，有助于用户管理正在进行的事件，并提供主动通知以协助用户规划计划中的活动。

可以从整个AWS组织聚合数据，以确保提供准确的信息。

帮助用户了解AWS中断如何直接影响他们和他们的AWS资源，提供警报、修复建议以及关于主动和预定活动的信息。

## Cloudwatch和Cloudtrail区别：

| 特性                 | Amazon CloudWatch                     | AWS CloudTrail                       |
|----------------------|---------------------------------------|-------------------------------------|
| 主要用途             | 监控和度量 AWS 资源性能                | 审计和跟踪 AWS 账户中的 API 活动     |
| 记录信息             | AWS 资源性能指标、日志数据             | AWS API 调用操作、事件历史记录      |
| 实时监控             | 是                                    | 否                                  |
| 警报和通知           | 是                                    | 否                                  |
| 图表和仪表板         | 是                                    | 否                                  |
| 日志收集和分析       | 是 (CloudWatch Logs)                  | 否                                  |
| 安全审计和合规性监控 | 否                                    | 是                                  |
| 安全威胁检测         | 否                                    | 是                                  |
| 事件历史记录         | 否                                    | 是                                  |
| 日志保留             | 部分支持                              | 可以保存在 Amazon S3 中           |
| 使用示例             | - 监控 EC2 实例的性能<br>- 设置警报   | - 跟踪谁执行了 AWS 资源的更改操作<br>- 合规性监控<br>- 安全审计<br>- 安全威胁检测 |

## 总结

SQS：是AWS的队列服务，可以保留消息达14天，支持多个生产者和消费者，被用来解耦在AWS中的应用程序。

SNS：是AWS的通知服务，支持多种订阅者（如电子邮件、Lambda、SQS、HTTP、移动应用等），可以向所有订阅者发送所有消息，不保留消息。

Kinesis：是实时数据流服务，具有数据持久性和分析能力。

MQ：是为ActiveMQ和RabbitMQ在云中提供的托管消息代理服务，支持MQTT和AMQP等协议。

CloudWatch：

指标：监控AWS服务和计费指标的性能

警报：基于指标自动通知，执行EC2操作，通知到SNS

日志：从EC2实例、服务器、Lambda函数等收集日志文件

事件（或EventBridge）：对AWS内的事件做出反应，或按计划触发规则

CloudTrail：审计在您的AWS账户内进行的API调用

CloudTrail Insights：自动分析您的CloudTrail事件

X-Ray：追踪通过您分布式应用程序进行的请求

AWS健康仪表板：影响您基础设施的所有AWS服务的状态

AWS账户健康仪表板：影响所有区域的AWS事件

CodeGuru：自动化代码审查和应用性能建议
